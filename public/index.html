<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Trendify</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <!-- Navigation bar -->
    <div class="navbar">
      <div class="nav-left">
        <button onclick="openPopup()">Add Clothing</button>
      </div>
      <div class="brand">Trendify</div>
    </div>

    <!-- Blurred Background -->
    <div class="background"></div>

    <!-- Message display area -->
    <div id="message" style="text-align: center; margin-top: 10px"></div>

    <!-- Popup Form -->
    <div id="popupForm">
      <div class="form-container">
        <button id="closePopup" onclick="closePopup()">Ã—</button>
        <h2>Add Clothing</h2>
        <form onsubmit="event.preventDefault(); addClothing();">
          <label for="name">Name of Clothing:</label>
          <input type="text" id="name" required />

          <label for="size">Size:</label>
          <select id="size" required>
            <option value="XS">XS</option>
            <option value="S">S</option>
            <option value="M">M</option>
            <option value="L">L</option>
            <option value="XL">XL</option>
          </select>

          <label for="color">Color:</label>
          <input type="text" id="color" required />

          <label for="material">Material:</label>
          <input type="text" id="material" required />

          <button type="submit">Add Clothing</button>
        </form>
      </div>
    </div>

    <!-- Confirmation Popup -->
    <div id="confirmationPopup">
      <div class="confirmation-container">
        <div class="confirmation-icon"></div>
        <h3>Awesome!</h3>
        <p>Your clothing item has been added successfully.</p>
        <button onclick="closeConfirmationPopup()">OK</button>
      </div>
    </div>

    <div class="row justify-content-center">
      <div class="col-md-10">
        <input
          type="text"
          id="searchInput"
          class="form-control"
          placeholder="Search item by name..."
          onkeyup="searchResources()"
        />
      </div>
    </div>

    <!-- Product List Display -->
    <div class="product-list" id="productList">
      <!-- Product items will be displayed here -->
    </div>

    <script src="js/clothing_add.js"></script>
    <script src="js/clothing_update.js"></script>
    <script>
      // JavaScript to open and close the popup
      function openPopup() {
        document.getElementById("popupForm").style.display = "flex";
      }

      function closePopup() {
        document.getElementById("popupForm").style.display = "none";
      }

      function openConfirmationPopup() {
        document.getElementById("confirmationPopup").style.display = "flex";
      }

      function closeConfirmationPopup() {
        document.getElementById("confirmationPopup").style.display = "none";
      }

      // Function to add clothing item to the product list
      function addClothing() {
        const name = document.getElementById("name").value;
        const size = document.getElementById("size").value;
        const color = document.getElementById("color").value;
        const material = document.getElementById("material").value;

        const newItem = { name, size, color, material };

        // Send the new item to the backend
        fetch("/api/add-clothing", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(newItem),
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.message === "Clothing item added successfully!") {
              displayProduct(newItem);
              clearForm();
              searchResources();
              closePopup();
              openConfirmationPopup();
            } else {
              document.getElementById("message").innerHTML =
                data.message || "Error adding clothing item.";
              document
                .getElementById("message")
                .setAttribute("class", "text-danger");
            }
          })
          .catch((err) => {
            console.error("Error:", err);
            document.getElementById("message").innerHTML =
              "Network error. Please try again later.";
            document
              .getElementById("message")
              .setAttribute("class", "text-danger");
          });
      }

      // Function to display a product item
      function displayProduct(item) {
        const productItem = document.createElement("div");
        productItem.classList.add("product-item");
        productItem.innerHTML = `
                <h3>${item.name}</h3>
                <p><strong>Size:</strong> ${item.size}</p>
                <p><strong>Color:</strong> ${item.color}</p>
                <p><strong>Material:</strong> ${item.material}</p>
            `;
        document.getElementById("productList").appendChild(productItem);
      }

      // Function to clear form fields
      function clearForm() {
        document.getElementById("name").value = "";
        document.getElementById("size").value = "XS"; // Reset to default value
        document.getElementById("color").value = "";
        document.getElementById("material").value = "";
      }

      // Load all clothing items on page load
      function loadClothingItems() {
        fetch("/api/get-clothing")
          .then((response) => response.json())
          .then((data) => {
            data.forEach((item) => displayProduct(item));
          })
          .catch((err) => console.error("Error:", err));
      }

      function searchResources() {
        const filter = document
          .getElementById("searchInput")
          .value.toUpperCase();
        const items = document.querySelectorAll(".product-item");
        items.forEach((item) => {
          const name = item.querySelector("h3").textContent;
          item.style.display = name.toUpperCase().includes(filter)
            ? ""
            : "none";
        });
      }

      // Call loadClothingItems on page load
      window.onload = loadClothingItems;
    </script>
  </body>
</html>
